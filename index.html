<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Purity Path</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes rotate-clockwise { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes rotate-counter { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
        
        body { 
            background-color: #000000; 
            color: white; 
            margin: 0; 
            font-family: -apple-system, system-ui, sans-serif; 
            overflow: hidden; 
            touch-action: none; 
        }

        /* استایل امواج نخی */
        .wave-strand {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 140%;
            height: 140%;
            margin-top: -70%;
            margin-left: -70%;
            border: 1px solid rgba(20, 184, 166, 0.15);
            border-radius: 41% 44% 45% 40%;
            animation: rotate-clockwise 15s infinite linear;
            pointer-events: none;
            transition: all 0.8s ease;
        }
        .wave-strand:nth-child(2) {
            width: 150%; height: 150%; margin-top: -75%; margin-left: -75%;
            border-radius: 45% 41% 40% 44%;
            animation: rotate-counter 20s infinite linear;
            border-color: rgba(20, 184, 166, 0.1);
        }
        .wave-strand:nth-child(3) {
            width: 135%; height: 135%; margin-top: -67.5%; margin-left: -67.5%;
            border-radius: 40% 45% 42% 48%;
            animation: rotate-clockwise 10s infinite linear;
            border-color: rgba(20, 184, 166, 0.08);
        }

        /* حالت خروشان (Raging) */
        .raging .wave-strand {
            border-color: rgba(45, 212, 191, 0.7);
            border-width: 2px;
            animation-duration: 3s !important;
            filter: drop-shadow(0 0 8px rgba(20, 184, 166, 0.5));
        }

        .glass-panel {
            background: rgba(15, 15, 15, 0.9);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .rtl { direction: rtl; }
        .ltr { direction: ltr; }

        /* افکت کلیک دکمه‌ها */
        .btn-press:active { transform: scale(0.9); opacity: 0.6; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const uiContent = {
            fa: { title: "مسیر پاکی", days: "روز", tap: "ثبت تداوم", saved: "ثبت شد", reset: "بازنشانی", lang: "زبان", confirm: "شمارنده صفر شود؟", cancel: "لغو", select: "انتخاب زبان" },
            en: { title: "PURITY PATH", days: "DAYS", tap: "TAP TO RECORD", saved: "RECORDED", reset: "RESET", lang: "LANG", confirm: "Reset streak to zero?", cancel: "Cancel", select: "Select Language" }
        };

        // آیکون کره زمین SVG
        const GlobeIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" className="w-6 h-6">
                <circle cx="12" cy="12" r="10" />
                <path d="M2 12h20" />
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
            </svg>
        );

        // آیکون ریست کلاسیک SVG
        const ResetIcon = () => (
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-5 h-5">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.72 0 0 0-6.74 2.74L3 8" />
                <path d="M3 3v5h5" />
            </svg>
        );

        function App() {
            const [streak, setStreak] = useState(0);
            const [lang, setLang] = useState('fa');
            const [isRaging, setIsRaging] = useState(false);
            const [isSaved, setIsSaved] = useState(false);
            const [showMenu, setShowMenu] = useState(false);
            const [isResetting, setIsResetting] = useState(false);

            useEffect(() => {
                const s = localStorage.getItem('streak_v3') || 0;
                const l = localStorage.getItem('lang_v3') || 'fa';
                const last = localStorage.getItem('date_v3');
                setStreak(Number(s));
                setLang(l);
                if (last === new Date().toDateString()) setIsSaved(true);
            }, []);

            const handleRecord = () => {
                if (isSaved) return;
                setIsRaging(true);
                setTimeout(() => {
                    const newS = streak + 1;
                    setStreak(newS);
                    setIsSaved(true);
                    localStorage.setItem('streak_v3', newS);
                    localStorage.setItem('date_v3', new Date().toDateString());
                    setTimeout(() => setIsRaging(false), 1500);
                }, 1500);
            };

            const t = uiContent[lang];

            return (
                <div className={`min-h-screen flex flex-col bg-black text-white relative ${lang === 'fa' ? 'rtl' : 'ltr'}`}>
                    
                    {/* هدر */}
                    <header className="p-6 flex justify-between items-center z-50">
                        <button onClick={() => setIsResetting(true)} className="w-10 h-10 rounded-full flex items-center justify-center bg-white/5 btn-press transition-all text-neutral-500">
                            <ResetIcon />
                        </button>
                        
                        <span className="text-[10px] font-black tracking-[0.5em] text-teal-500/60 uppercase">{t.title}</span>
                        
                        <button onClick={() => setShowMenu(true)} className="w-10 h-10 rounded-full flex items-center justify-center bg-white/5 btn-press transition-all text-neutral-500">
                            <GlobeIcon />
                        </button>
                    </header>

                    {/* بخش مرکزی */}
                    <main className="flex-1 flex flex-col items-center justify-center px-6 relative">
                        <div className="text-center mb-10">
                            <h2 className={`text-2xl font-light tracking-wide transition-colors duration-1000 ${isSaved ? 'text-teal-400' : 'text-neutral-400'}`}>
                                {isSaved ? t.saved : t.tap}
                            </h2>
                        </div>

                        <div className={`relative w-64 h-64 flex items-center justify-center ${isRaging ? 'raging' : ''}`}>
                            <div className="wave-strand"></div>
                            <div className="wave-strand"></div>
                            <div className="wave-strand"></div>

                            <button 
                                onPointerDown={() => !isSaved && setIsRaging(true)}
                                onPointerUp={() => !isSaved && !isRaging && setIsRaging(false)}
                                onClick={handleRecord}
                                className={`relative w-56 h-56 rounded-full flex flex-col items-center justify-center transition-all duration-700 z-20 ${isSaved ? 'bg-teal-900/10 border-teal-500/40 shadow-[0_0_40px_rgba(20,184,166,0.15)]' : 'bg-neutral-900/20 border-white/5 active:scale-95'}`}
                                style={{ borderWidth: '1.5px' }}
                            >
                                <span className={`text-8xl font-thin transition-colors duration-1000 ${isSaved ? 'text-teal-400' : 'text-neutral-300'}`}>
                                    {streak}
                                </span>
                            </button>
                        </div>

                        <div className="mt-10 flex flex-col items-center">
                            <span className="text-xs font-black tracking-[0.8em] text-teal-500/40 uppercase mb-2">{t.days}</span>
                            <div className="h-16 w-[1px] bg-gradient-to-b from-teal-500/50 to-transparent"></div>
                        </div>
                    </main>

                    {/* منوی زبان (کشویی از پایین) */}
                    <div className={`fixed inset-0 z-[100] transition-all duration-500 ${showMenu ? 'visible' : 'invisible'}`}>
                        <div className={`absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity ${showMenu ? 'opacity-100' : 'opacity-0'}`} onClick={() => setShowMenu(false)}></div>
                        <div className={`absolute bottom-0 left-0 right-0 glass-panel rounded-t-[3rem] p-10 transition-transform duration-500 transform ${showMenu ? 'translate-y-0' : 'translate-y-full'}`}>
                            <div className="w-12 h-1.5 bg-white/10 rounded-full mx-auto mb-10"></div>
                            <h3 className="text-lg font-bold mb-8 text-center opacity-80 tracking-widest uppercase">{t.select}</h3>
                            <div className="grid grid-cols-2 gap-4">
                                {['fa', 'en'].map(l => (
                                    <button key={l} onClick={() => { setLang(l); localStorage.setItem('lang_v3', l); setShowMenu(false); }} className={`py-6 rounded-2xl border transition-all font-medium ${lang === l ? 'bg-teal-500/10 border-teal-500/50 text-teal-400' : 'bg-white/5 border-transparent text-neutral-500'}`}>
                                        {l === 'fa' ? 'فارسی' : 'ENGLISH'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* تاییدیه ریست */}
                    {isResetting && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/90 backdrop-blur-md">
                            <div className="w-full max-w-xs bg-neutral-900/80 border border-white/10 rounded-[2.5rem] p-10 text-center shadow-2xl">
                                <div className="w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 text-red-500">
                                    <ResetIcon />
                                </div>
                                <p className="text-neutral-300 text-sm mb-10 leading-relaxed font-light">{t.confirm}</p>
                                <div className="space-y-4">
                                    <button onClick={() => { setStreak(0); setIsSaved(false); localStorage.setItem('streak_v3', 0); localStorage.removeItem('date_v3'); setIsResetting(false); }} className="w-full py-4 bg-red-600 rounded-2xl text-xs font-black uppercase tracking-[0.2em]">{t.reset}</button>
                                    <button onClick={() => setIsResetting(false)} className="w-full py-4 bg-white/5 text-neutral-500 rounded-2xl text-xs font-bold uppercase tracking-[0.1em]">{t.cancel}</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <footer className="p-10 text-center opacity-10 text-[7px] font-black tracking-[1.2em] uppercase pointer-events-none">.. ..</footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

