<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مسیر پاکی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.css" rel="stylesheet">
    <style>
        @keyframes dash { to { stroke-dashoffset: 0; } }
        @keyframes wave-rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        body { 
            background-color: #050505; 
            color: white; 
            margin: 0; 
            font-family: sans-serif; 
            overflow: hidden;
            touch-action: manipulation;
        }

        /* افکت امواج دریا */
        .wave {
            position: absolute;
            width: 150%;
            height: 150%;
            background: rgba(20, 184, 166, 0.1);
            border-radius: 38% 42% 40% 45%;
            animation: wave-rotate 10s infinite linear;
            pointer-events: none;
            transition: all 0.5s ease;
        }
        .wave:nth-child(2) { animation-duration: 7s; border-radius: 45% 40% 43% 38%; opacity: 0.05; }
        
        /* حالت خروشان با لمس */
        .raging .wave {
            background: rgba(20, 184, 166, 0.4);
            animation-duration: 2s !important;
            box-shadow: 0 0 30px rgba(20, 184, 166, 0.3);
            border-radius: 30% 35% 32% 38%;
        }

        .bg-noise {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const langData = {
            fa: { title: "مسیر پاکی", done: "امروز ثبت شد", record: "ثبت روز جدید", days: "روز", reset: "ریست", langName: "فارسی", quote: "تو قوی‌تر از عادتی", confirm: "آیا مطمئن هستید؟" },
            en: { title: "PURITY PATH", done: "TODAY DONE", record: "RECORD DAY", days: "DAYS", reset: "RESET", langName: "English", quote: "You are stronger", confirm: "Are you sure?" }
        };

        function App() {
            const [streak, setStreak] = useState(0);
            const [isChecked, setIsChecked] = useState(false);
            const [isAnimating, setIsAnimating] = useState(false);
            const [isRaging, setIsRaging] = useState(false);
            const [lang, setLang] = useState('fa');
            const [showMenu, setShowMenu] = useState(false);

            useEffect(() => {
                const s = localStorage.getItem('streak') || 0;
                const l = localStorage.getItem('lang') || 'fa';
                const last = localStorage.getItem('last_date');
                setStreak(parseInt(s));
                setLang(l);
                if (last === new Date().toDateString()) setIsChecked(true);
            }, []);

            const handleCheck = () => {
                if (isChecked || isAnimating) return;
                setIsAnimating(true);
                setIsRaging(true);
                setTimeout(() => {
                    const newS = streak + 1;
                    setStreak(newS);
                    setIsChecked(true);
                    localStorage.setItem('streak', newS);
                    localStorage.setItem('last_date', new Date().toDateString());
                    setIsAnimating(false);
                    setTimeout(() => setIsRaging(false), 1000);
                }, 1500);
            };

            const reset = () => {
                if(window.confirm(langData[lang].confirm)) {
                    setStreak(0);
                    setIsChecked(false);
                    localStorage.setItem('streak', 0);
                    localStorage.removeItem('last_date');
                }
            };

            const t = langData[lang];

            return (
                <div className={`min-h-screen flex flex-col relative overflow-hidden ${lang === 'fa' ? 'rtl' : 'ltr'}`} dir={lang === 'fa' ? 'rtl' : 'ltr'}>
                    <div className="fixed inset-0 bg-noise pointer-events-none opacity-40"></div>
                    
                    {/* Header */}
                    <header className="p-6 flex justify-between items-center z-30">
                        <button onClick={reset} className="text-neutral-500 active:text-red-500">
                            <i data-lucide="refresh-ccw" className="w-6 h-6"></i>
                        </button>
                        <h1 className="text-xs font-bold tracking-widest text-teal-500 opacity-70">{t.title}</h1>
                        <button onClick={() => setShowMenu(true)} className="text-neutral-500">
                            <i data-lucide="menu" className="w-6 h-6"></i>
                        </button>
                    </header>

                    {/* Main */}
                    <main className="flex-1 flex flex-col items-center justify-center z-10 px-4">
                        <h2 className={`mb-12 text-2xl font-light transition-all ${isChecked ? 'text-teal-400' : 'text-white'}`}>
                            {isChecked ? t.done : t.record}
                        </h2>

                        <div className={`relative w-64 h-64 flex items-center justify-center ${isRaging ? 'raging' : ''}`}>
                            {/* امواج دریا */}
                            <div className="wave"></div>
                            <div className="wave"></div>
                            
                            <button 
                                onPointerDown={() => setIsRaging(true)}
                                onPointerUp={() => !isAnimating && setIsRaging(false)}
                                onClick={handleCheck}
                                disabled={isChecked || isAnimating}
                                className={`relative w-full h-full rounded-full border flex flex-col items-center justify-center transition-all duration-500 z-20 ${isChecked ? 'border-teal-500/50 bg-black shadow-[0_0_50px_rgba(20,184,166,0.2)]' : 'border-neutral-800 bg-[#0A0A0A]'}`}
                            >
                                {isAnimating && (
                                    <svg className="absolute inset-0 w-full h-full -rotate-90" viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="48" fill="none" stroke="#14b8a6" strokeWidth="2" strokeDasharray="301.6" strokeDashoffset="301.6" style={{animation: 'dash 1.5s linear forwards'}} />
                                    </svg>
                                )}
                                <span className={`text-7xl font-light ${isChecked ? 'text-teal-400' : 'text-neutral-600'}`}>{streak}</span>
                                <span className="text-neutral-500 text-[10px] mt-2 uppercase tracking-widest">{t.days}</span>
                            </button>
                        </div>
                        <p className="mt-16 text-neutral-500 italic text-sm opacity-50">"{t.quote}"</p>
                    </main>

                    {/* پنل کشویی زبان (Drawer) */}
                    <div className={`fixed inset-0 z-50 bg-black/80 backdrop-blur-sm transition-opacity ${showMenu ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
                        <div className={`absolute top-0 bottom-0 w-64 bg-[#0A0A0A] p-8 border-neutral-800 transition-transform duration-300 ${showMenu ? 'translate-x-0' : (lang === 'fa' ? '-translate-x-full' : 'translate-x-full')} ${lang === 'fa' ? 'left-0 border-r' : 'right-0 border-l'}`}>
                            <div className="flex justify-between items-center mb-12">
                                <h3 className="font-bold">Select Language</h3>
                                <button onClick={() => setShowMenu(false)}><i data-lucide="x" className="w-6 h-6"></i></button>
                            </div>
                            <div className="space-y-4">
                                {['fa', 'en'].map(l => (
                                    <button key={l} onClick={() => { setLang(l); localStorage.setItem('lang', l); setShowMenu(false); }} className={`w-full p-4 rounded-2xl text-right flex justify-between items-center ${lang === l ? 'bg-teal-500/10 text-teal-400 border border-teal-500/20' : 'bg-neutral-900 text-neutral-500'}`}>
                                        {langData[l].langName}
                                        {lang === l && <i data-lucide="check" className="w-4 h-4"></i>}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        
        // آپدیت آیکون‌ها
        setInterval(() => { if (window.lucide) window.lucide.createIcons(); }, 500);
    </script>
</body>
</html>
